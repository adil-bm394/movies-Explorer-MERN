{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useDispatch } from \"react-redux\";\nimport axios from \"axios\";\nimport { login } from \"../redux/slices/userSlice\";\nimport { toast } from \"react-toastify\";\nconst useLogin = () => {\n  _s();\n  const {\n    register,\n    handleSubmit,\n    formState: {\n      errors\n    },\n    reset\n  } = useForm();\n  const [loginError, setLoginError] = useState(null);\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const checkToken = async () => {\n    const token = localStorage.getItem(\"authToken\");\n    if (token) {\n      try {\n        const response = await axios.get(\"http://localhost:8000/api/v1/check-token\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        if (response.data.success) {\n          const {\n            user,\n            token\n          } = response.data;\n          dispatch(login({\n            id: user._id,\n            name: user.name,\n            email: user.email,\n            phone: user.phone,\n            token\n          }));\n        } else {\n          localStorage.removeItem(\"authToken\");\n        }\n      } catch (err) {\n        console.error(err);\n        localStorage.removeItem(\"authToken\");\n      }\n    }\n  };\n  useEffect(() => {\n    checkToken();\n  }, []);\n  const onSubmit = async data => {\n    try {\n      const response = await axios.post(\"http://localhost:8000/api/v1/login\", data);\n      if (response.data.success) {\n        const {\n          user,\n          token\n        } = response.data;\n        setLoginError(null);\n        dispatch(login({\n          id: user._id,\n          name: user.name,\n          email: user.email,\n          phone: user.phone,\n          token\n        }));\n        localStorage.setItem(\"authToken\", token);\n        navigate(\"/\");\n        toast.success(\"Login Successfully\");\n      } else {\n        setLoginError(response.data.message || \"Login failed. Please try again.\");\n      }\n    } catch (err) {\n      console.error(err);\n      setLoginError(\"An error occurred during login\");\n    }\n  };\n  return {\n    register,\n    handleSubmit,\n    onSubmit,\n    errors,\n    loginError\n  };\n};\n_s(useLogin, \"eAud7h89R63kWGGgHM+YGCaH3S4=\", false, function () {\n  return [useForm, useNavigate, useDispatch];\n});\nexport default useLogin;","map":{"version":3,"names":["useEffect","useForm","useNavigate","useDispatch","axios","login","toast","useLogin","_s","register","handleSubmit","formState","errors","reset","loginError","setLoginError","useState","navigate","dispatch","checkToken","token","localStorage","getItem","response","get","headers","Authorization","data","success","user","id","_id","name","email","phone","removeItem","err","console","error","onSubmit","post","setItem","message"],"sources":["/home/mohdadil/Desktop/MERN/movies-explorer-mern/frontend/src/hooks/useLogin.tsx"],"sourcesContent":["import { useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useDispatch } from \"react-redux\";\nimport axios from \"axios\";\nimport { login } from \"../redux/slices/userSlice\";\nimport { toast } from \"react-toastify\";\n\ninterface LoginFormInputs {\n  email: string;\n  password: string;\n}\n\nconst useLogin = () => {\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n    reset,\n  } = useForm<LoginFormInputs>();\n  const [loginError, setLoginError] = useState<string | null>(null);\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n\n  const checkToken = async () => {\n    const token = localStorage.getItem(\"authToken\");\n    if (token) {\n      try {\n        const response = await axios.get(\n          \"http://localhost:8000/api/v1/check-token\",\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          }\n        );\n\n        if (response.data.success) {\n          const { user, token } = response.data;\n          dispatch(\n            login({\n              id: user._id,\n              name: user.name,\n              email: user.email,\n              phone: user.phone,\n              token,\n            })\n          );\n        } else {\n          localStorage.removeItem(\"authToken\");\n        }\n      } catch (err) {\n        console.error(err);\n        localStorage.removeItem(\"authToken\");\n      }\n    }\n  };\n\n  useEffect(() => {\n    checkToken();\n  }, []);\n\n  const onSubmit = async (data: LoginFormInputs) => {\n    try {\n      const response = await axios.post(\n        \"http://localhost:8000/api/v1/login\",\n        data\n      );\n      if (response.data.success) {\n        const { user, token } = response.data;\n        setLoginError(null);\n        dispatch(\n          login({\n            id: user._id,\n            name: user.name,\n            email: user.email,\n            phone: user.phone,\n            token,\n          })\n        );\n        localStorage.setItem(\"authToken\", token);\n        navigate(\"/\");\n        toast.success(\"Login Successfully\");\n      } else {\n        setLoginError(\n          response.data.message || \"Login failed. Please try again.\"\n        );\n      }\n    } catch (err) {\n      console.error(err);\n      setLoginError(\"An error occurred during login\");\n    }\n  };\n\n  return {\n    register,\n    handleSubmit,\n    onSubmit,\n    errors,\n    loginError,\n  };\n};\n\nexport default useLogin;\n"],"mappings":";AAAA,SAASA,SAAS,QAAQ,OAAO;AACjC,SAASC,OAAO,QAAQ,iBAAiB;AACzC,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,WAAW,QAAQ,aAAa;AACzC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,KAAK,QAAQ,2BAA2B;AACjD,SAASC,KAAK,QAAQ,gBAAgB;AAOtC,MAAMC,QAAQ,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACrB,MAAM;IACJC,QAAQ;IACRC,YAAY;IACZC,SAAS,EAAE;MAAEC;IAAO,CAAC;IACrBC;EACF,CAAC,GAAGZ,OAAO,CAAkB,CAAC;EAC9B,MAAM,CAACa,UAAU,EAAEC,aAAa,CAAC,GAAGC,QAAQ,CAAgB,IAAI,CAAC;EACjE,MAAMC,QAAQ,GAAGf,WAAW,CAAC,CAAC;EAC9B,MAAMgB,QAAQ,GAAGf,WAAW,CAAC,CAAC;EAE9B,MAAMgB,UAAU,GAAG,MAAAA,CAAA,KAAY;IAC7B,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;IAC/C,IAAIF,KAAK,EAAE;MACT,IAAI;QACF,MAAMG,QAAQ,GAAG,MAAMnB,KAAK,CAACoB,GAAG,CAC9B,0CAA0C,EAC1C;UACEC,OAAO,EAAE;YACPC,aAAa,EAAE,UAAUN,KAAK;UAChC;QACF,CACF,CAAC;QAED,IAAIG,QAAQ,CAACI,IAAI,CAACC,OAAO,EAAE;UACzB,MAAM;YAAEC,IAAI;YAAET;UAAM,CAAC,GAAGG,QAAQ,CAACI,IAAI;UACrCT,QAAQ,CACNb,KAAK,CAAC;YACJyB,EAAE,EAAED,IAAI,CAACE,GAAG;YACZC,IAAI,EAAEH,IAAI,CAACG,IAAI;YACfC,KAAK,EAAEJ,IAAI,CAACI,KAAK;YACjBC,KAAK,EAAEL,IAAI,CAACK,KAAK;YACjBd;UACF,CAAC,CACH,CAAC;QACH,CAAC,MAAM;UACLC,YAAY,CAACc,UAAU,CAAC,WAAW,CAAC;QACtC;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;QAClBf,YAAY,CAACc,UAAU,CAAC,WAAW,CAAC;MACtC;IACF;EACF,CAAC;EAEDnC,SAAS,CAAC,MAAM;IACdmB,UAAU,CAAC,CAAC;EACd,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMoB,QAAQ,GAAG,MAAOZ,IAAqB,IAAK;IAChD,IAAI;MACF,MAAMJ,QAAQ,GAAG,MAAMnB,KAAK,CAACoC,IAAI,CAC/B,oCAAoC,EACpCb,IACF,CAAC;MACD,IAAIJ,QAAQ,CAACI,IAAI,CAACC,OAAO,EAAE;QACzB,MAAM;UAAEC,IAAI;UAAET;QAAM,CAAC,GAAGG,QAAQ,CAACI,IAAI;QACrCZ,aAAa,CAAC,IAAI,CAAC;QACnBG,QAAQ,CACNb,KAAK,CAAC;UACJyB,EAAE,EAAED,IAAI,CAACE,GAAG;UACZC,IAAI,EAAEH,IAAI,CAACG,IAAI;UACfC,KAAK,EAAEJ,IAAI,CAACI,KAAK;UACjBC,KAAK,EAAEL,IAAI,CAACK,KAAK;UACjBd;QACF,CAAC,CACH,CAAC;QACDC,YAAY,CAACoB,OAAO,CAAC,WAAW,EAAErB,KAAK,CAAC;QACxCH,QAAQ,CAAC,GAAG,CAAC;QACbX,KAAK,CAACsB,OAAO,CAAC,oBAAoB,CAAC;MACrC,CAAC,MAAM;QACLb,aAAa,CACXQ,QAAQ,CAACI,IAAI,CAACe,OAAO,IAAI,iCAC3B,CAAC;MACH;IACF,CAAC,CAAC,OAAON,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;MAClBrB,aAAa,CAAC,gCAAgC,CAAC;IACjD;EACF,CAAC;EAED,OAAO;IACLN,QAAQ;IACRC,YAAY;IACZ6B,QAAQ;IACR3B,MAAM;IACNE;EACF,CAAC;AACH,CAAC;AAACN,EAAA,CAxFID,QAAQ;EAAA,QAMRN,OAAO,EAEMC,WAAW,EACXC,WAAW;AAAA;AAiF9B,eAAeI,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}